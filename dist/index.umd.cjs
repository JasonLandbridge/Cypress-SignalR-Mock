(function(a,u){typeof exports=="object"&&typeof module<"u"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(a=typeof globalThis<"u"?globalThis:a||self,u(a.index={}))})(this,function(a){"use strict";var gr=Object.defineProperty;var wr=(a,u,h)=>u in a?gr(a,u,{enumerable:!0,configurable:!0,writable:!0,value:h}):a[u]=h;var b=(a,u,h)=>(wr(a,typeof u!="symbol"?u+"":u,h),h);class u{static debug(r){this._logLevel>=4&&console.debug(this._prefix+r)}static info(r,e=void 0){this._logLevel>=3&&console.info(this._prefix+r,e)}static warn(r){this._logLevel>=1&&console.warn(this._prefix+r)}static error(r,e=!0){if(this._logLevel>=0){if(e)throw new Error(this._prefix+r);console.error(this._prefix+r)}}static setLogLevel(r){this._logLevel=r}}b(u,"_prefix","[Cypress-SignalR-Mock] - "),b(u,"_logLevel",3);var h=function(t,r){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},h(t,r)};function v(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");h(t,r);function e(){this.constructor=t}t.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}function E(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function y(t,r){var e=typeof Symbol=="function"&&t[Symbol.iterator];if(!e)return t;var n=e.call(t),o,i=[],s;try{for(;(r===void 0||r-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(c){s={error:c}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(s)throw s.error}}return i}function _(t,r,e){if(e||arguments.length===2)for(var n=0,o=r.length,i;n<o;n++)(i||!(n in r))&&(i||(i=Array.prototype.slice.call(r,0,n)),i[n]=r[n]);return t.concat(i||Array.prototype.slice.call(r))}function p(t){return typeof t=="function"}function A(t){var r=function(n){Error.call(n),n.stack=new Error().stack},e=t(r);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var P=A(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,o){return o+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function I(t,r){if(t){var e=t.indexOf(r);0<=e&&t.splice(e,1)}}var m=function(){function t(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var r,e,n,o,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var c=E(s),l=c.next();!l.done;l=c.next()){var T=l.value;T.remove(this)}}catch(f){r={error:f}}finally{try{l&&!l.done&&(e=c.return)&&e.call(c)}finally{if(r)throw r.error}}else s.remove(this);var rr=this.initialTeardown;if(p(rr))try{rr()}catch(f){i=f instanceof P?f.errors:[f]}var er=this._finalizers;if(er){this._finalizers=null;try{for(var C=E(er),d=C.next();!d.done;d=C.next()){var mr=d.value;try{U(mr)}catch(f){i=i??[],f instanceof P?i=_(_([],y(i)),y(f.errors)):i.push(f)}}}catch(f){n={error:f}}finally{try{d&&!d.done&&(o=C.return)&&o.call(C)}finally{if(n)throw n.error}}}if(i)throw new P(i)}},t.prototype.add=function(r){var e;if(r&&r!==this)if(this.closed)U(r);else{if(r instanceof t){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(r)}},t.prototype._hasParent=function(r){var e=this._parentage;return e===r||Array.isArray(e)&&e.includes(r)},t.prototype._addParent=function(r){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(r),e):e?[e,r]:r},t.prototype._removeParent=function(r){var e=this._parentage;e===r?this._parentage=null:Array.isArray(e)&&I(e,r)},t.prototype.remove=function(r){var e=this._finalizers;e&&I(e,r),r instanceof t&&r._removeParent(this)},t.EMPTY=function(){var r=new t;return r.closed=!0,r}(),t}(),R=m.EMPTY;function L(t){return t instanceof m||t&&"closed"in t&&p(t.remove)&&p(t.add)&&p(t.unsubscribe)}function U(t){p(t)?t():t.unsubscribe()}var $={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},x={setTimeout:function(t,r){for(var e=[],n=2;n<arguments.length;n++)e[n-2]=arguments[n];var o=x.delegate;return o!=null&&o.setTimeout?o.setTimeout.apply(o,_([t,r],y(e))):setTimeout.apply(void 0,_([t,r],y(e)))},clearTimeout:function(t){var r=x.delegate;return((r==null?void 0:r.clearTimeout)||clearTimeout)(t)},delegate:void 0};function tr(t){x.setTimeout(function(){throw t})}function H(){}function g(t){t()}var V=function(t){v(r,t);function r(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,L(e)&&e.add(n)):n.destination=sr,n}return r.create=function(e,n,o){return new M(e,n,o)},r.prototype.next=function(e){this.isStopped||this._next(e)},r.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},r.prototype._next=function(e){this.destination.next(e)},r.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},r.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},r}(m),nr=Function.prototype.bind;function j(t,r){return nr.call(t,r)}var or=function(){function t(r){this.partialObserver=r}return t.prototype.next=function(r){var e=this.partialObserver;if(e.next)try{e.next(r)}catch(n){w(n)}},t.prototype.error=function(r){var e=this.partialObserver;if(e.error)try{e.error(r)}catch(n){w(n)}else w(r)},t.prototype.complete=function(){var r=this.partialObserver;if(r.complete)try{r.complete()}catch(e){w(e)}},t}(),M=function(t){v(r,t);function r(e,n,o){var i=t.call(this)||this,s;if(p(e)||!e)s={next:e??void 0,error:n??void 0,complete:o??void 0};else{var c;i&&$.useDeprecatedNextContext?(c=Object.create(e),c.unsubscribe=function(){return i.unsubscribe()},s={next:e.next&&j(e.next,c),error:e.error&&j(e.error,c),complete:e.complete&&j(e.complete,c)}):s=e}return i.destination=new or(s),i}return r}(V);function w(t){tr(t)}function ir(t){throw t}var sr={closed:!0,next:H,error:ir,complete:H},ur=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function cr(t){return t}function ar(t){return t.length===0?cr:t.length===1?t[0]:function(e){return t.reduce(function(n,o){return o(n)},e)}}var F=function(){function t(r){r&&(this._subscribe=r)}return t.prototype.lift=function(r){var e=new t;return e.source=this,e.operator=r,e},t.prototype.subscribe=function(r,e,n){var o=this,i=fr(r)?r:new M(r,e,n);return g(function(){var s=o,c=s.operator,l=s.source;i.add(c?c.call(i,l):l?o._subscribe(i):o._trySubscribe(i))}),i},t.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(e){r.error(e)}},t.prototype.forEach=function(r,e){var n=this;return e=Y(e),new e(function(o,i){var s=new M({next:function(c){try{r(c)}catch(l){i(l),s.unsubscribe()}},error:i,complete:o});n.subscribe(s)})},t.prototype._subscribe=function(r){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(r)},t.prototype[ur]=function(){return this},t.prototype.pipe=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return ar(r)(this)},t.prototype.toPromise=function(r){var e=this;return r=Y(r),new r(function(n,o){var i;e.subscribe(function(s){return i=s},function(s){return o(s)},function(){return n(i)})})},t.create=function(r){return new t(r)},t}();function Y(t){var r;return(r=t??$.Promise)!==null&&r!==void 0?r:Promise}function lr(t){return t&&p(t.next)&&p(t.error)&&p(t.complete)}function fr(t){return t&&t instanceof V||lr(t)&&L(t)}var hr=A(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),D=function(t){v(r,t);function r(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return r.prototype.lift=function(e){var n=new B(this,this);return n.operator=e,n},r.prototype._throwIfClosed=function(){if(this.closed)throw new hr},r.prototype.next=function(e){var n=this;g(function(){var o,i;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var s=E(n.currentObservers),c=s.next();!c.done;c=s.next()){var l=c.value;l.next(e)}}catch(T){o={error:T}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}}})},r.prototype.error=function(e){var n=this;g(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=e;for(var o=n.observers;o.length;)o.shift().error(e)}})},r.prototype.complete=function(){var e=this;g(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var n=e.observers;n.length;)n.shift().complete()}})},r.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(r.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),r.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},r.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},r.prototype._innerSubscribe=function(e){var n=this,o=this,i=o.hasError,s=o.isStopped,c=o.observers;return i||s?R:(this.currentObservers=null,c.push(e),new m(function(){n.currentObservers=null,I(c,e)}))},r.prototype._checkFinalizedStatuses=function(e){var n=this,o=n.hasError,i=n.thrownError,s=n.isStopped;o?e.error(i):s&&e.complete()},r.prototype.asObservable=function(){var e=new F;return e.source=this,e},r.create=function(e,n){return new B(e,n)},r}(F),B=function(t){v(r,t);function r(e,n){var o=t.call(this)||this;return o.destination=e,o.source=n,o}return r.prototype.next=function(e){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.next)===null||o===void 0||o.call(n,e)},r.prototype.error=function(e){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.error)===null||o===void 0||o.call(n,e)},r.prototype.complete=function(){var e,n;(n=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||n===void 0||n.call(e)},r.prototype._subscribe=function(e){var n,o;return(o=(n=this.source)===null||n===void 0?void 0:n.subscribe(e))!==null&&o!==void 0?o:R},r}(D);class pr{constructor(r,e){this._subject=r,this._observer=e}dispose(){const r=this._subject.observers.indexOf(this._observer);r>-1&&this._subject.observers.splice(r,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(e=>{})}}class br{constructor(){this.observers=[]}next(r){for(const e of this.observers)e.next(r)}error(r){for(const e of this.observers)e.error&&e.error(r)}complete(){for(const r of this.observers)r.complete&&r.complete()}subscribe(r){return this.observers.push(r),new pr(this,r)}}class dr{constructor(r){b(this,"_hubConnectionData",[]);b(this,"_serverInvokes",[]);b(this,"_invokeResponses",{});b(this,"name");this.name=r}publish(r,...e){r=r.toLowerCase();const n=this._hubConnectionData.filter(o=>o.messageType===r);if(n.length===0){u.warn(`No subscribers for ${r}`);return}u.debug(`Publishing action: ${r} to ${n.length} subscribers`),n.forEach(o=>{o.channel.next({name:r,values:e})})}verify(r,e){r=r.toLowerCase();const n=this._serverInvokes.filter(o=>o.action===r);e&&e(n)}mockInvoke(r,e){this._invokeResponses[r]=e}unmockInvoke(r){delete this._invokeResponses[r]}on(r,e){r=r.toLowerCase(),this._hubConnectionData.some(i=>i.messageType===r)||this._hubConnectionData.push({messageType:r,isStream:!1,channel:new D,subscriptions:[]});let n=this._hubConnectionData.find(i=>i.messageType===r);if(!n)throw new Error(`Could not find connection data for ${r}`);let o=n.channel.subscribe(i=>{e(...i.values)});n.subscriptions.push({handler:e,subscription:o})}stream(r,...e){r=r.toLowerCase(),this._hubConnectionData.some(i=>i.messageType===r)||this._hubConnectionData.push({messageType:r,isStream:!0,channel:new D,subscriptions:[]});let n=this._hubConnectionData.find(i=>i.messageType===r);if(!n)throw new Error(`Could not find connection data for ${r}`);const o=new br;return n.channel.subscribe({next:i=>o.next(i),error:i=>o.error(i),complete:()=>o.complete()}),o}invoke(r,...e){return new Promise(n=>{this._serverInvokes.push({action:r,args:e});const o=this._invokeResponses[r];n(o!==void 0?o:0)})}off(r,e){r=r.toLowerCase();const n=this._hubConnectionData.findIndex(o=>o.messageType===r);if(n==-1){u.warn(`No channels registered for action name: ${r}`);return}if(e){const o=this._hubConnectionData[n].subscriptions.findIndex(i=>i.handler===e);if(o==-1){u.warn(`Could not find the handler to delete for action name: ${r}`);return}this._hubConnectionData[n].subscriptions.splice(o,1),this._hubConnectionData[n].subscriptions.length===0&&this._hubConnectionData.splice(n,1)}else this._hubConnectionData.splice(n,1)}onclose(r){}start(){return Promise.resolve()}async stop(){return Promise.resolve()}onreconnecting(r){}onreconnected(r){}send(r,...e){return Promise.resolve()}}function q(){return O()?!1:window.hasOwnProperty("Cypress")}function S(){return!O()&&window["cypress-signalr-mock"]?window["cypress-signalr-mock"]:(G(),S())}function vr(t){O()||(window["cypress-signalr-mock"]=t)}function G(){vr(yr())}function yr(){return{mocks:[]}}function k(t){return S().mocks.find(e=>e.name===t)??null}function O(){return typeof window>"u"?(u.error("window is not defined. This most likely happens during SSR, which is not supported",!1),!0):!1}function J(){var t;return typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.hasOwnProperty("VITEST"))&&process.env.VITEST==="true"}function _r(){if(!q()){u.debug("Cypress is not running, skipping setup of Cypress commands");return}const t=window.Cypress;t.Commands.add("hubMockInvoke",K),t.Commands.add("hubUnmockInvoke",Q),t.Commands.add("hubPublish",W),t.Commands.add("hubVerifyInvokes",X),t.Commands.add("hubClear",z),t.Commands.add("hubPrintData",Z)}function K(t,r,e){const n=k(t);if(!n){u.error(`[cy.hubMockInvoke] - HubConnectionMock not found for ${t}`);return}n.mockInvoke(r,e)}function Q(t,r){const e=k(t);if(!e){u.error(`[cy.hubUnmockInvoke] - HubConnectionMock not found for ${t}`);return}e.unmockInvoke(r)}function W(t,r,...e){const n=k(t);if(!n){u.error(`[cy.hubPublish] - HubConnectionMock not found for ${t}`);return}n.publish(r,...e)}function X(t,r,e){const n=k(t);if(!n){u.error(`[cy.hubVerify] - HubConnectionMock not found for hub with name: ${t}`);return}n.verify(r,e)}function Z(){u.info('Current window["cypress-signalr-mock"] data:',S())}function z(){G()}_r(),N("default");function N(t,{debug:r,enableForVitest:e}={}){if(r&&u.setLogLevel(4),!e&&J()&&u.info(`Vitest is running but 'enableForVitest' is ${e}, skip enabling CypressSignalRMock...`),q()||e&&J()){const n=new dr(t);return S().mocks.push(n),n}return null}a.hubClear=z,a.hubMockInvoke=K,a.hubPrintData=Z,a.hubPublish=W,a.hubUnmockInvoke=Q,a.hubVerify=X,a.useCypressSignalRMock=N,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.cjs.map
